import{L as e,d as t,c as s,I as n,S as o,E as r,T as a,J as i,U as l,p as u,q as p,o as c,a as d,b as m,s as h,h as g,t as f,l as y,v,g as _,w,u as b,r as k}from"./types-DH8sDsgV.js";import"./index-CCeDs9WQ.js";var x={};function I(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}function T(){let e,t,s,n="",o=[];function r(e,t){if(""===e)return void a(t);if(e.startsWith(":"))return;const s=e.indexOf(":");if(-1===s)return void i(e,"");const n=s+1;i(e.slice(0,s),n<e.length&&" "===e[n]?e.slice(n+1):e.slice(n))}function a(n){o.length>0&&(n.enqueue({event:e,data:o.join("\n"),id:t,retry:s}),o=[],e=void 0,s=void 0)}function i(n,r){switch(n){case"event":e=r;break;case"data":o.push(r);break;case"id":t=r;break;case"retry":const n=parseInt(r,10);isNaN(n)||(s=n)}}return new TransformStream({transform(e,t){const{lines:s,incompleteLine:o}=function(e,t){const s=[];let n=e;for(let o=0;o<t.length;){const e=t[o++];"\n"===e?(s.push(n),n=""):"\r"===e?(s.push(n),n="","\n"===t[o]&&o++):n+=e}return{lines:s,incompleteLine:n}}(n,e);n=o;for(let n=0;n<s.length;n++)r(s[n],t)},flush(e){r(n,e),a(e)}})}function S(e){const t={};return e.headers.forEach((e,s)=>{t[s]=e}),t}var C=(({prefix:e,size:t=16,alphabet:o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const a=s(o,t);if(null==e)return a;if(o.includes(r))throw new n({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${o}".`});return t=>`${e}${r}${a(t)}`})();function q(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}function R({apiKey:t,environmentVariableName:s,apiKeyParameterName:n="apiKey",description:o}){if("string"==typeof t)return t;if(null!=t)throw new e({message:`${o} API key must be a string.`});if("undefined"==typeof process)throw new e({message:`${o} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(null==(t=x[s]))throw new e({message:`${o} API key is missing. Pass it using the '${n}' parameter or the ${s} environment variable.`});if("string"!=typeof t)throw new e({message:`${o} API key must be a string. The value of the ${s} environment variable is not a string.`});return t}var M=Symbol.for("vercel.ai.validator");function $(e){return function(e){return"object"==typeof e&&null!==e&&M in e&&!0===e[M]&&"validate"in e}(e)?e:(t=e,s=e=>{const s=t.safeParse(e);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}},{[M]:!0,validate:s});var t,s}function j({value:e,schema:t}){const s=$(t);try{if(null==s.validate)return{success:!0,value:e};const t=s.validate(e);return t.success?t:{success:!1,error:a.wrap({value:e,cause:t.error})}}catch(n){return{success:!1,error:a.wrap({value:e,cause:n})}}}function N({text:e,schema:t}){try{const s=o.parse(e);return null==t?s:function({value:e,schema:t}){const s=j({value:e,schema:t});if(!s.success)throw a.wrap({value:e,cause:s.error});return s.value}({value:s,schema:t})}catch(s){if(i.isInstance(s)||a.isInstance(s))throw s;throw new i({text:e,cause:s})}}function P({text:e,schema:t}){try{const s=o.parse(e);if(null==t)return{success:!0,value:s,rawValue:s};const n=j({value:s,schema:t});return n.success?{...n,rawValue:s}:n}catch(s){return{success:!1,error:i.isInstance(s)?s:new i({text:e,cause:s})}}}function H(e){try{return o.parse(e),!0}catch(t){return!1}}function O({provider:e,providerOptions:t,schema:s}){if(null==(null==t?void 0:t[e]))return;const o=j({value:t[e],schema:s});if(!o.success)throw new n({argument:"providerOptions",message:`invalid ${e} provider options`,cause:o.error});return o.value}var E=()=>globalThis.fetch,A=async({url:e,headers:t,body:s,failedResponseHandler:n,successfulResponseHandler:o,abortSignal:r,fetch:a})=>F({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(s),values:s},failedResponseHandler:n,successfulResponseHandler:o,abortSignal:r,fetch:a}),F=async({url:e,headers:s={},body:n,successfulResponseHandler:o,failedResponseHandler:r,abortSignal:a,fetch:i=E()})=>{try{const p=await i(e,{method:"POST",headers:(l=s,Object.fromEntries(Object.entries(l).filter(([e,t])=>null!=t))),body:n.content,signal:a}),c=S(p);if(!p.ok){let s;try{s=await r({response:p,url:e,requestBodyValues:n.values})}catch(u){if(q(u)||t.isInstance(u))throw u;throw new t({message:"Failed to process error response",cause:u,statusCode:p.status,url:e,responseHeaders:c,requestBodyValues:n.values})}throw s.value}try{return await o({response:p,url:e,requestBodyValues:n.values})}catch(u){if(u instanceof Error&&(q(u)||t.isInstance(u)))throw u;throw new t({message:"Failed to process successful response",cause:u,statusCode:p.status,url:e,responseHeaders:c,requestBodyValues:n.values})}}catch(u){if(q(u))throw u;if(u instanceof TypeError&&"fetch failed"===u.message){const s=u.cause;if(null!=s)throw new t({message:`Cannot connect to API: ${s.message}`,cause:s,url:e,requestBodyValues:n.values,isRetryable:!0})}throw u}var l},V=e=>async({response:t})=>{const s=S(t);if(null==t.body)throw new r({});return{responseHeaders:s,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(T()).pipeThrough(new TransformStream({transform({data:t},s){"[DONE]"!==t&&s.enqueue(P({text:t,schema:e}))}}))}},B=e=>async({response:s,url:n,requestBodyValues:o})=>{const r=await s.text(),a=P({text:r,schema:e}),i=S(s);if(!a.success)throw new t({message:"Invalid JSON response",cause:a.error,statusCode:s.status,responseHeaders:i,responseBody:r,url:n,requestBodyValues:o});return{responseHeaders:i,value:a.value,rawValue:a.rawValue}},{btoa:D,atob:L}=globalThis;function U(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),s=L(t);return Uint8Array.from(s,e=>e.codePointAt(0))}function W(e){let t="";for(let s=0;s<e.length;s++)t+=String.fromCodePoint(e[s]);return D(t)}function J(e){var t,s;return null!=(s=null==(t=null==e?void 0:e.content)?void 0:t.map(({token:e,logprob:t,top_logprobs:s})=>({token:e,logprob:t,topLogprobs:s?s.map(({token:e,logprob:t})=>({token:e,logprob:t})):[]})))?s:void 0}function z(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var G=c({error:c({message:h(),type:h().nullish(),param:w().nullish(),code:b([h(),g()]).nullish()})}),K=(({errorSchema:e,errorToMessage:s,isRetryable:n})=>async({response:o,url:r,requestBodyValues:a})=>{const i=await o.text(),l=S(o);if(""===i.trim())return{responseHeaders:l,value:new t({message:o.statusText,url:r,requestBodyValues:a,statusCode:o.status,responseHeaders:l,responseBody:i,isRetryable:null==n?void 0:n(o)})};try{const u=N({text:i,schema:e});return{responseHeaders:l,value:new t({message:s(u),url:r,requestBodyValues:a,statusCode:o.status,responseHeaders:l,responseBody:i,data:u,isRetryable:null==n?void 0:n(o,u)})}}catch(u){return{responseHeaders:l,value:new t({message:o.statusText,url:r,requestBodyValues:a,statusCode:o.status,responseHeaders:l,responseBody:i,isRetryable:null==n?void 0:n(o)})}}})({errorSchema:G,errorToMessage:e=>e.error.message});function Y({id:e,model:t,created:s}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=s?new Date(1e3*s):void 0}}var Q=class{constructor(e,t,s){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=s}get supportsStructuredOutputs(){var e;return null!=(e=this.settings.structuredOutputs)?e:te(this.modelId)}get defaultObjectGenerationMode(){return this.modelId.startsWith("gpt-4o-audio-preview")?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:s,temperature:n,topP:o,topK:r,frequencyPenalty:a,presencePenalty:i,stopSequences:u,responseFormat:p,seed:c,providerMetadata:d}){var m,h,g,f,y,v,_,w;const b=e.type,k=[];null!=r&&k.push({type:"unsupported-setting",setting:"topK"}),"json"!==(null==p?void 0:p.type)||null==p.schema||this.supportsStructuredOutputs||k.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const x=this.settings.useLegacyFunctionCalling;if(x&&!0===this.settings.parallelToolCalls)throw new l({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(x&&this.supportsStructuredOutputs)throw new l({functionality:"structuredOutputs with useLegacyFunctionCalling"});const{messages:I,warnings:T}=function({prompt:e,useLegacyFunctionCalling:t=!1,systemMessageMode:s="system"}){const n=[],o=[];for(const{role:r,content:a}of e)switch(r){case"system":switch(s){case"system":n.push({role:"system",content:a});break;case"developer":n.push({role:"developer",content:a});break;case"remove":o.push({type:"other",message:"system messages are removed for this model"});break;default:throw new Error(`Unsupported system message mode: ${s}`)}break;case"user":if(1===a.length&&"text"===a[0].type){n.push({role:"user",content:a[0].text});break}n.push({role:"user",content:a.map((e,t)=>{var s,n,o,r;switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image_url",image_url:{url:e.image instanceof URL?e.image.toString():`data:${null!=(s=e.mimeType)?s:"image/jpeg"};base64,${W(e.image)}`,detail:null==(o=null==(n=e.providerMetadata)?void 0:n.openai)?void 0:o.imageDetail}};case"file":if(e.data instanceof URL)throw new l({functionality:"'File content parts with URL data' functionality not supported."});switch(e.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:e.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:e.data,format:"mp3"}};case"application/pdf":return{type:"file",file:{filename:null!=(r=e.filename)?r:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${e.data}`}};default:throw new l({functionality:`File content part type ${e.mimeType} in user messages`})}}})});break;case"assistant":{let e="";const s=[];for(const t of a)switch(t.type){case"text":e+=t.text;break;case"tool-call":s.push({id:t.toolCallId,type:"function",function:{name:t.toolName,arguments:JSON.stringify(t.args)}})}if(t){if(s.length>1)throw new l({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});n.push({role:"assistant",content:e,function_call:s.length>0?s[0].function:void 0})}else n.push({role:"assistant",content:e,tool_calls:s.length>0?s:void 0});break}case"tool":for(const e of a)t?n.push({role:"function",name:e.toolName,content:JSON.stringify(e.result)}):n.push({role:"tool",tool_call_id:e.toolCallId,content:JSON.stringify(e.result)});break;default:throw new Error(`Unsupported role: ${r}`)}return{messages:n,warnings:o}}({prompt:t,useLegacyFunctionCalling:x,systemMessageMode:se(this.modelId)});k.push(...T);const S={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs||void 0,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:s,temperature:n,top_p:o,frequency_penalty:a,presence_penalty:i,response_format:"json"===(null==p?void 0:p.type)?this.supportsStructuredOutputs&&null!=p.schema?{type:"json_schema",json_schema:{schema:p.schema,strict:!0,name:null!=(m=p.name)?m:"response",description:p.description}}:{type:"json_object"}:void 0,stop:u,seed:c,max_completion_tokens:null==(h=null==d?void 0:d.openai)?void 0:h.maxCompletionTokens,store:null==(g=null==d?void 0:d.openai)?void 0:g.store,metadata:null==(f=null==d?void 0:d.openai)?void 0:f.metadata,prediction:null==(y=null==d?void 0:d.openai)?void 0:y.prediction,reasoning_effort:null!=(_=null==(v=null==d?void 0:d.openai)?void 0:v.reasoningEffort)?_:this.settings.reasoningEffort,messages:I};switch(te(this.modelId)?(null!=S.temperature&&(S.temperature=void 0,k.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=S.top_p&&(S.top_p=void 0,k.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),null!=S.frequency_penalty&&(S.frequency_penalty=void 0,k.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=S.presence_penalty&&(S.presence_penalty=void 0,k.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=S.logit_bias&&(S.logit_bias=void 0,k.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=S.logprobs&&(S.logprobs=void 0,k.push({type:"other",message:"logprobs is not supported for reasoning models"})),null!=S.top_logprobs&&(S.top_logprobs=void 0,k.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=S.max_tokens&&(null==S.max_completion_tokens&&(S.max_completion_tokens=S.max_tokens),S.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&null!=S.temperature&&(S.temperature=void 0,k.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),b){case"regular":{const{tools:t,tool_choice:s,functions:n,function_call:o,toolWarnings:r}=function({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:s}){var n;const o=(null==(n=e.tools)?void 0:n.length)?e.tools:void 0,r=[];if(null==o)return{tools:void 0,tool_choice:void 0,toolWarnings:r};const a=e.toolChoice;if(t){const e=[];for(const t of o)"provider-defined"===t.type?r.push({type:"unsupported-tool",tool:t}):e.push({name:t.name,description:t.description,parameters:t.parameters});if(null==a)return{functions:e,function_call:void 0,toolWarnings:r};switch(a.type){case"auto":case"none":case void 0:return{functions:e,function_call:void 0,toolWarnings:r};case"required":throw new l({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:e,function_call:{name:a.toolName},toolWarnings:r}}}const i=[];for(const l of o)"provider-defined"===l.type?r.push({type:"unsupported-tool",tool:l}):i.push({type:"function",function:{name:l.name,description:l.description,parameters:l.parameters,strict:!!s||void 0}});if(null==a)return{tools:i,tool_choice:void 0,toolWarnings:r};const u=a.type;switch(u){case"auto":case"none":case"required":return{tools:i,tool_choice:u,toolWarnings:r};case"tool":return{tools:i,tool_choice:{type:"function",function:{name:a.toolName}},toolWarnings:r};default:throw new l({functionality:`Unsupported tool choice type: ${u}`})}}({mode:e,useLegacyFunctionCalling:x,structuredOutputs:this.supportsStructuredOutputs});return{args:{...S,tools:t,tool_choice:s,functions:n,function_call:o},warnings:[...k,...r]}}case"object-json":return{args:{...S,response_format:this.supportsStructuredOutputs&&null!=e.schema?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:null!=(w=e.name)?w:"response",description:e.description}}:{type:"json_object"}},warnings:k};case"object-tool":return{args:x?{...S,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...S,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:!!this.supportsStructuredOutputs||void 0}}]},warnings:k};default:throw new Error(`Unsupported type: ${b}`)}}async doGenerate(e){var t,s,n,o,r,a,i,l;const{args:u,warnings:p}=this.getArgs(e),{responseHeaders:c,value:d,rawValue:m}=await A({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:I(this.config.headers(),e.headers),body:u,failedResponseHandler:K,successfulResponseHandler:B(Z),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:h,...g}=u,f=d.choices[0],y=null==(t=d.usage)?void 0:t.completion_tokens_details,v=null==(s=d.usage)?void 0:s.prompt_tokens_details,_={openai:{}};return null!=(null==y?void 0:y.reasoning_tokens)&&(_.openai.reasoningTokens=null==y?void 0:y.reasoning_tokens),null!=(null==y?void 0:y.accepted_prediction_tokens)&&(_.openai.acceptedPredictionTokens=null==y?void 0:y.accepted_prediction_tokens),null!=(null==y?void 0:y.rejected_prediction_tokens)&&(_.openai.rejectedPredictionTokens=null==y?void 0:y.rejected_prediction_tokens),null!=(null==v?void 0:v.cached_tokens)&&(_.openai.cachedPromptTokens=null==v?void 0:v.cached_tokens),{text:null!=(n=f.message.content)?n:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&f.message.function_call?[{toolCallType:"function",toolCallId:C(),toolName:f.message.function_call.name,args:f.message.function_call.arguments}]:null==(o=f.message.tool_calls)?void 0:o.map(e=>{var t;return{toolCallType:"function",toolCallId:null!=(t=e.id)?t:C(),toolName:e.function.name,args:e.function.arguments}}),finishReason:z(f.finish_reason),usage:{promptTokens:null!=(a=null==(r=d.usage)?void 0:r.prompt_tokens)?a:NaN,completionTokens:null!=(l=null==(i=d.usage)?void 0:i.completion_tokens)?l:NaN},rawCall:{rawPrompt:h,rawSettings:g},rawResponse:{headers:c,body:m},request:{body:JSON.stringify(u)},response:Y(d),warnings:p,logprobs:J(f.logprobs),providerMetadata:_}}async doStream(e){if(this.settings.simulateStreaming){const t=await this.doGenerate(e);return{stream:new ReadableStream({start(e){if(e.enqueue({type:"response-metadata",...t.response}),t.text&&e.enqueue({type:"text-delta",textDelta:t.text}),t.toolCalls)for(const s of t.toolCalls)e.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:s.toolCallId,toolName:s.toolName,argsTextDelta:s.args}),e.enqueue({type:"tool-call",...s});e.enqueue({type:"finish",finishReason:t.finishReason,usage:t.usage,logprobs:t.logprobs,providerMetadata:t.providerMetadata}),e.close()}}),rawCall:t.rawCall,rawResponse:t.rawResponse,warnings:t.warnings}}const{args:t,warnings:s}=this.getArgs(e),n={...t,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:o,value:r}=await A({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:I(this.config.headers(),e.headers),body:n,failedResponseHandler:K,successfulResponseHandler:V(ee),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:a,...i}=t,l=[];let p,c="unknown",d={promptTokens:void 0,completionTokens:void 0},m=!0;const{useLegacyFunctionCalling:h}=this.settings,g={openai:{}};return{stream:r.pipeThrough(new TransformStream({transform(e,t){var s,n,o,r,a,i,f,y,v,_,w,b;if(!e.success)return c="error",void t.enqueue({type:"error",error:e.error});const k=e.value;if("error"in k)return c="error",void t.enqueue({type:"error",error:k.error});if(m&&(m=!1,t.enqueue({type:"response-metadata",...Y(k)})),null!=k.usage){const{prompt_tokens:e,completion_tokens:t,prompt_tokens_details:s,completion_tokens_details:n}=k.usage;d={promptTokens:null!=e?e:void 0,completionTokens:null!=t?t:void 0},null!=(null==n?void 0:n.reasoning_tokens)&&(g.openai.reasoningTokens=null==n?void 0:n.reasoning_tokens),null!=(null==n?void 0:n.accepted_prediction_tokens)&&(g.openai.acceptedPredictionTokens=null==n?void 0:n.accepted_prediction_tokens),null!=(null==n?void 0:n.rejected_prediction_tokens)&&(g.openai.rejectedPredictionTokens=null==n?void 0:n.rejected_prediction_tokens),null!=(null==s?void 0:s.cached_tokens)&&(g.openai.cachedPromptTokens=null==s?void 0:s.cached_tokens)}const x=k.choices[0];if(null!=(null==x?void 0:x.finish_reason)&&(c=z(x.finish_reason)),null==(null==x?void 0:x.delta))return;const I=x.delta;null!=I.content&&t.enqueue({type:"text-delta",textDelta:I.content});const T=J(null==x?void 0:x.logprobs);(null==T?void 0:T.length)&&(void 0===p&&(p=[]),p.push(...T));const S=h&&null!=I.function_call?[{type:"function",id:C(),function:I.function_call,index:0}]:I.tool_calls;if(null!=S)for(const p of S){const e=p.index;if(null==l[e]){if("function"!==p.type)throw new u({data:p,message:"Expected 'function' type."});if(null==p.id)throw new u({data:p,message:"Expected 'id' to be a string."});if(null==(null==(s=p.function)?void 0:s.name))throw new u({data:p,message:"Expected 'function.name' to be a string."});l[e]={id:p.id,type:"function",function:{name:p.function.name,arguments:null!=(n=p.function.arguments)?n:""},hasFinished:!1};const i=l[e];null!=(null==(o=i.function)?void 0:o.name)&&null!=(null==(r=i.function)?void 0:r.arguments)&&(i.function.arguments.length>0&&t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:i.id,toolName:i.function.name,argsTextDelta:i.function.arguments}),H(i.function.arguments)&&(t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(a=i.id)?a:C(),toolName:i.function.name,args:i.function.arguments}),i.hasFinished=!0));continue}const c=l[e];c.hasFinished||(null!=(null==(i=p.function)?void 0:i.arguments)&&(c.function.arguments+=null!=(y=null==(f=p.function)?void 0:f.arguments)?y:""),t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:c.id,toolName:c.function.name,argsTextDelta:null!=(v=p.function.arguments)?v:""}),null!=(null==(_=c.function)?void 0:_.name)&&null!=(null==(w=c.function)?void 0:w.arguments)&&H(c.function.arguments)&&(t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(b=c.id)?b:C(),toolName:c.function.name,args:c.function.arguments}),c.hasFinished=!0))}},flush(e){var t,s;e.enqueue({type:"finish",finishReason:c,logprobs:p,usage:{promptTokens:null!=(t=d.promptTokens)?t:NaN,completionTokens:null!=(s=d.completionTokens)?s:NaN},...null!=g?{providerMetadata:g}:{}})}})),rawCall:{rawPrompt:a,rawSettings:i},rawResponse:{headers:o},request:{body:JSON.stringify(n)},warnings:s}}},X=c({prompt_tokens:g().nullish(),completion_tokens:g().nullish(),prompt_tokens_details:c({cached_tokens:g().nullish()}).nullish(),completion_tokens_details:c({reasoning_tokens:g().nullish(),accepted_prediction_tokens:g().nullish(),rejected_prediction_tokens:g().nullish()}).nullish()}).nullish(),Z=c({id:h().nullish(),created:g().nullish(),model:h().nullish(),choices:m(c({message:c({role:y("assistant").nullish(),content:h().nullish(),function_call:c({arguments:h(),name:h()}).nullish(),tool_calls:m(c({id:h().nullish(),type:y("function"),function:c({name:h(),arguments:h()})})).nullish()}),index:g(),logprobs:c({content:m(c({token:h(),logprob:g(),top_logprobs:m(c({token:h(),logprob:g()}))})).nullable()}).nullish(),finish_reason:h().nullish()})),usage:X}),ee=b([c({id:h().nullish(),created:g().nullish(),model:h().nullish(),choices:m(c({delta:c({role:v(["assistant"]).nullish(),content:h().nullish(),function_call:c({name:h().optional(),arguments:h().optional()}).nullish(),tool_calls:m(c({index:g(),id:h().nullish(),type:y("function").nullish(),function:c({name:h().nullish(),arguments:h().nullish()})})).nullish()}).nullish(),logprobs:c({content:m(c({token:h(),logprob:g(),top_logprobs:m(c({token:h(),logprob:g()}))})).nullable()}).nullish(),finish_reason:h().nullish(),index:g()})),usage:X}),G]);function te(e){return e.startsWith("o")||e.startsWith("gpt-5")}function se(e){var t,s;return te(e)?null!=(s=null==(t=ne[e])?void 0:t.systemMessageMode)?s:"developer":"system"}var ne={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function oe(e){return null==e?void 0:e.tokens.map((t,s)=>({token:t,logprob:e.token_logprobs[s],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[s]).map(([e,t])=>({token:e,logprob:t})):[]}))}var re=class{constructor(e,t,s){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=s}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:s,maxTokens:n,temperature:o,topP:r,topK:a,frequencyPenalty:i,presencePenalty:u,stopSequences:p,responseFormat:c,seed:m}){var h;const g=e.type,f=[];null!=a&&f.push({type:"unsupported-setting",setting:"topK"}),null!=c&&"text"!==c.type&&f.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:y,stopSequences:v}=function({prompt:e,inputFormat:t,user:s="user",assistant:n="assistant"}){if("prompt"===t&&1===e.length&&"user"===e[0].role&&1===e[0].content.length&&"text"===e[0].content[0].type)return{prompt:e[0].content[0].text};let o="";"system"===e[0].role&&(o+=`${e[0].content}\n\n`,e=e.slice(1));for(const{role:r,content:a}of e)switch(r){case"system":throw new d({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":o+=`${s}:\n${a.map(e=>{switch(e.type){case"text":return e.text;case"image":throw new l({functionality:"images"})}}).join("")}\n\n`;break;case"assistant":o+=`${n}:\n${a.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new l({functionality:"tool-call messages"})}}).join("")}\n\n`;break;case"tool":throw new l({functionality:"tool messages"});default:throw new Error(`Unsupported role: ${r}`)}return o+=`${n}:\n`,{prompt:o,stopSequences:[`\n${s}:`]}}({prompt:s,inputFormat:t}),_=[...null!=v?v:[],...null!=p?p:[]],w={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:n,temperature:o,top_p:r,frequency_penalty:i,presence_penalty:u,seed:m,prompt:y,stop:_.length>0?_:void 0};switch(g){case"regular":if(null==(h=e.tools)?void 0:h.length)throw new l({functionality:"tools"});if(e.toolChoice)throw new l({functionality:"toolChoice"});return{args:w,warnings:f};case"object-json":throw new l({functionality:"object-json mode"});case"object-tool":throw new l({functionality:"object-tool mode"});default:throw new Error(`Unsupported type: ${g}`)}}async doGenerate(e){const{args:t,warnings:s}=this.getArgs(e),{responseHeaders:n,value:o,rawValue:r}=await A({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:I(this.config.headers(),e.headers),body:t,failedResponseHandler:K,successfulResponseHandler:B(ae),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:a,...i}=t,l=o.choices[0];return{text:l.text,usage:{promptTokens:o.usage.prompt_tokens,completionTokens:o.usage.completion_tokens},finishReason:z(l.finish_reason),logprobs:oe(l.logprobs),rawCall:{rawPrompt:a,rawSettings:i},rawResponse:{headers:n,body:r},response:Y(o),warnings:s,request:{body:JSON.stringify(t)}}}async doStream(e){const{args:t,warnings:s}=this.getArgs(e),n={...t,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:o,value:r}=await A({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:I(this.config.headers(),e.headers),body:n,failedResponseHandler:K,successfulResponseHandler:V(ie),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:a,...i}=t;let l,u="unknown",p={promptTokens:Number.NaN,completionTokens:Number.NaN},c=!0;return{stream:r.pipeThrough(new TransformStream({transform(e,t){if(!e.success)return u="error",void t.enqueue({type:"error",error:e.error});const s=e.value;if("error"in s)return u="error",void t.enqueue({type:"error",error:s.error});c&&(c=!1,t.enqueue({type:"response-metadata",...Y(s)})),null!=s.usage&&(p={promptTokens:s.usage.prompt_tokens,completionTokens:s.usage.completion_tokens});const n=s.choices[0];null!=(null==n?void 0:n.finish_reason)&&(u=z(n.finish_reason)),null!=(null==n?void 0:n.text)&&t.enqueue({type:"text-delta",textDelta:n.text});const o=oe(null==n?void 0:n.logprobs);(null==o?void 0:o.length)&&(void 0===l&&(l=[]),l.push(...o))},flush(e){e.enqueue({type:"finish",finishReason:u,logprobs:l,usage:p})}})),rawCall:{rawPrompt:a,rawSettings:i},rawResponse:{headers:o},warnings:s,request:{body:JSON.stringify(n)}}}},ae=c({id:h().nullish(),created:g().nullish(),model:h().nullish(),choices:m(c({text:h(),finish_reason:h(),logprobs:c({tokens:m(h()),token_logprobs:m(g()),top_logprobs:m(k(h(),g())).nullable()}).nullish()})),usage:c({prompt_tokens:g(),completion_tokens:g()})}),ie=b([c({id:h().nullish(),created:g().nullish(),model:h().nullish(),choices:m(c({text:h(),finish_reason:h().nullish(),index:g(),logprobs:c({tokens:m(h()),token_logprobs:m(g()),top_logprobs:m(k(h(),g())).nullable()}).nullish()})),usage:c({prompt_tokens:g(),completion_tokens:g()}).nullish()}),G]),le=class{constructor(e,t,s){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=s}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return null!=(e=this.settings.maxEmbeddingsPerCall)?e:2048}get supportsParallelCalls(){var e;return null==(e=this.settings.supportsParallelCalls)||e}async doEmbed({values:e,headers:t,abortSignal:s}){if(e.length>this.maxEmbeddingsPerCall)throw new p({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const{responseHeaders:n,value:o}=await A({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:I(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:K,successfulResponseHandler:B(ue),abortSignal:s,fetch:this.config.fetch});return{embeddings:o.data.map(e=>e.embedding),usage:o.usage?{tokens:o.usage.prompt_tokens}:void 0,rawResponse:{headers:n}}}},ue=c({data:m(c({embedding:m(g())})),usage:c({prompt_tokens:g()}).nullish()}),pe={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},ce=new Set(["gpt-image-1"]),de=class{constructor(e,t,s){this.modelId=e,this.settings=t,this.config=s,this.specificationVersion="v1"}get maxImagesPerCall(){var e,t;return null!=(t=null!=(e=this.settings.maxImagesPerCall)?e:pe[this.modelId])?t:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:s,aspectRatio:n,seed:o,providerOptions:r,headers:a,abortSignal:i}){var l,u,p,c;const d=[];null!=n&&d.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=o&&d.push({type:"unsupported-setting",setting:"seed"});const m=null!=(p=null==(u=null==(l=this.config._internal)?void 0:l.currentDate)?void 0:u.call(l))?p:new Date,{value:h,responseHeaders:g}=await A({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:I(this.config.headers(),a),body:{model:this.modelId,prompt:e,n:t,size:s,...null!=(c=r.openai)?c:{},...ce.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:K,successfulResponseHandler:B(me),abortSignal:i,fetch:this.config.fetch});return{images:h.data.map(e=>e.b64_json),warnings:d,response:{timestamp:m,modelId:this.modelId,headers:g}}}},me=c({data:m(c({b64_json:h()}))}),he=c({include:m(h()).nullish(),language:h().nullish(),prompt:h().nullish(),temperature:g().min(0).max(1).nullish().default(0),timestampGranularities:m(v(["word","segment"])).nullish().default(["segment"])}),ge={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},fe=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({audio:e,mediaType:t,providerOptions:s}){var n,o,r,a,i;const l=O({provider:"openai",providerOptions:s,schema:he}),u=new FormData,p=e instanceof Uint8Array?new Blob([e]):new Blob([U(e)]);if(u.append("model",this.modelId),u.append("file",new File([p],"audio",{type:t})),l){const e={include:null!=(n=l.include)?n:void 0,language:null!=(o=l.language)?o:void 0,prompt:null!=(r=l.prompt)?r:void 0,temperature:null!=(a=l.temperature)?a:void 0,timestamp_granularities:null!=(i=l.timestampGranularities)?i:void 0};for(const t in e){const s=e[t];void 0!==s&&u.append(t,String(s))}}return{formData:u,warnings:[]}}async doGenerate(e){var t,s,n,o,r,a;const i=null!=(n=null==(s=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:s.call(t))?n:new Date,{formData:l,warnings:u}=this.getArgs(e),{value:p,responseHeaders:c,rawValue:d}=await(async({url:e,headers:t,formData:s,failedResponseHandler:n,successfulResponseHandler:o,abortSignal:r,fetch:a})=>F({url:e,headers:t,body:{content:s,values:Object.fromEntries(s.entries())},failedResponseHandler:n,successfulResponseHandler:o,abortSignal:r,fetch:a}))({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:I(this.config.headers(),e.headers),formData:l,failedResponseHandler:K,successfulResponseHandler:B(ye),abortSignal:e.abortSignal,fetch:this.config.fetch}),m=null!=p.language&&p.language in ge?ge[p.language]:void 0;return{text:p.text,segments:null!=(r=null==(o=p.words)?void 0:o.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end})))?r:[],language:m,durationInSeconds:null!=(a=p.duration)?a:void 0,warnings:u,response:{timestamp:i,modelId:this.modelId,headers:c,body:d}}}},ye=c({text:h(),language:h().nullish(),duration:g().nullish(),words:m(c({word:h(),start:g(),end:g()})).nullish()});function ve({finishReason:e,hasToolCalls:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}var _e=class{constructor(e,t){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsStructuredOutputs=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}getArgs({mode:e,maxTokens:t,temperature:s,stopSequences:n,topP:o,topK:r,presencePenalty:a,frequencyPenalty:i,seed:u,prompt:p,providerMetadata:c,responseFormat:d}){var m,h,g;const f=[],y=function(e){if(e.startsWith("o")||e.startsWith("gpt-5"))return e.startsWith("o1-mini")||e.startsWith("o1-preview")?{isReasoningModel:!0,systemMessageMode:"remove",requiredAutoTruncation:!1}:{isReasoningModel:!0,systemMessageMode:"developer",requiredAutoTruncation:!1};return{isReasoningModel:!1,systemMessageMode:"system",requiredAutoTruncation:!1}}(this.modelId),v=e.type;null!=r&&f.push({type:"unsupported-setting",setting:"topK"}),null!=u&&f.push({type:"unsupported-setting",setting:"seed"}),null!=a&&f.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=i&&f.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=n&&f.push({type:"unsupported-setting",setting:"stopSequences"});const{messages:_,warnings:w}=function({prompt:e,systemMessageMode:t}){const s=[],n=[];for(const{role:o,content:r}of e)switch(o){case"system":switch(t){case"system":s.push({role:"system",content:r});break;case"developer":s.push({role:"developer",content:r});break;case"remove":n.push({type:"other",message:"system messages are removed for this model"});break;default:throw new Error(`Unsupported system message mode: ${t}`)}break;case"user":s.push({role:"user",content:r.map((e,t)=>{var s,n,o,r;switch(e.type){case"text":return{type:"input_text",text:e.text};case"image":return{type:"input_image",image_url:e.image instanceof URL?e.image.toString():`data:${null!=(s=e.mimeType)?s:"image/jpeg"};base64,${W(e.image)}`,detail:null==(o=null==(n=e.providerMetadata)?void 0:n.openai)?void 0:o.imageDetail};case"file":if(e.data instanceof URL)throw new l({functionality:"File URLs in user messages"});if("application/pdf"===e.mimeType)return{type:"input_file",filename:null!=(r=e.filename)?r:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${e.data}`};throw new l({functionality:"Only PDF files are supported in user messages"})}})});break;case"assistant":for(const e of r)switch(e.type){case"text":s.push({role:"assistant",content:[{type:"output_text",text:e.text}]});break;case"tool-call":s.push({type:"function_call",call_id:e.toolCallId,name:e.toolName,arguments:JSON.stringify(e.args)})}break;case"tool":for(const e of r)s.push({type:"function_call_output",call_id:e.toolCallId,output:JSON.stringify(e.result)});break;default:throw new Error(`Unsupported role: ${o}`)}return{messages:s,warnings:n}}({prompt:p,systemMessageMode:y.systemMessageMode});f.push(...w);const b=O({provider:"openai",providerOptions:c,schema:ke}),k=null==(m=null==b?void 0:b.strictSchemas)||m,x={model:this.modelId,input:_,temperature:s,top_p:o,max_output_tokens:t,..."json"===(null==d?void 0:d.type)&&{text:{format:null!=d.schema?{type:"json_schema",strict:k,name:null!=(h=d.name)?h:"response",description:d.description,schema:d.schema}:{type:"json_object"}}},metadata:null==b?void 0:b.metadata,parallel_tool_calls:null==b?void 0:b.parallelToolCalls,previous_response_id:null==b?void 0:b.previousResponseId,store:null==b?void 0:b.store,user:null==b?void 0:b.user,instructions:null==b?void 0:b.instructions,...y.isReasoningModel&&(null!=(null==b?void 0:b.reasoningEffort)||null!=(null==b?void 0:b.reasoningSummary))&&{reasoning:{...null!=(null==b?void 0:b.reasoningEffort)&&{effort:b.reasoningEffort},...null!=(null==b?void 0:b.reasoningSummary)&&{summary:b.reasoningSummary}}},...y.requiredAutoTruncation&&{truncation:"auto"}};switch(y.isReasoningModel&&(null!=x.temperature&&(x.temperature=void 0,f.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=x.top_p&&(x.top_p=void 0,f.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))),v){case"regular":{const{tools:t,tool_choice:s,toolWarnings:n}=function({mode:e,strict:t}){var s;const n=(null==(s=e.tools)?void 0:s.length)?e.tools:void 0,o=[];if(null==n)return{tools:void 0,tool_choice:void 0,toolWarnings:o};const r=e.toolChoice,a=[];for(const l of n)switch(l.type){case"function":a.push({type:"function",name:l.name,description:l.description,parameters:l.parameters,strict:!!t||void 0});break;case"provider-defined":"openai.web_search_preview"===l.id?a.push({type:"web_search_preview",search_context_size:l.args.searchContextSize,user_location:l.args.userLocation}):o.push({type:"unsupported-tool",tool:l});break;default:o.push({type:"unsupported-tool",tool:l})}if(null==r)return{tools:a,tool_choice:void 0,toolWarnings:o};const i=r.type;switch(i){case"auto":case"none":case"required":return{tools:a,tool_choice:i,toolWarnings:o};case"tool":return"web_search_preview"===r.toolName?{tools:a,tool_choice:{type:"web_search_preview"},toolWarnings:o}:{tools:a,tool_choice:{type:"function",name:r.toolName},toolWarnings:o};default:throw new l({functionality:`Unsupported tool choice type: ${i}`})}}({mode:e,strict:k});return{args:{...x,tools:t,tool_choice:s},warnings:[...f,...n]}}case"object-json":return{args:{...x,text:{format:null!=e.schema?{type:"json_schema",strict:k,name:null!=(g=e.name)?g:"response",description:e.description,schema:e.schema}:{type:"json_object"}}},warnings:f};case"object-tool":return{args:{...x,tool_choice:{type:"function",name:e.tool.name},tools:[{type:"function",name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:k}]},warnings:f};default:throw new Error(`Unsupported type: ${v}`)}}async doGenerate(e){var s,n,o,r,a,i,l;const{args:u,warnings:p}=this.getArgs(e),d=this.config.url({path:"/responses",modelId:this.modelId}),{responseHeaders:v,value:_,rawValue:w}=await A({url:d,headers:I(this.config.headers(),e.headers),body:u,failedResponseHandler:K,successfulResponseHandler:B(c({id:h(),created_at:g(),error:c({message:h(),code:h()}).nullish(),model:h(),output:m(f("type",[c({type:y("message"),role:y("assistant"),content:m(c({type:y("output_text"),text:h(),annotations:m(c({type:y("url_citation"),start_index:g(),end_index:g(),url:h(),title:h()}))}))}),c({type:y("function_call"),call_id:h(),name:h(),arguments:h()}),c({type:y("web_search_call")}),c({type:y("computer_call")}),c({type:y("reasoning"),summary:m(c({type:y("summary_text"),text:h()}))})])),incomplete_details:c({reason:h()}).nullable(),usage:we})),abortSignal:e.abortSignal,fetch:this.config.fetch});if(_.error)throw new t({message:_.error.message,url:d,requestBodyValues:u,statusCode:400,responseHeaders:v,responseBody:w,isRetryable:!1});const b=_.output.filter(e=>"message"===e.type).flatMap(e=>e.content).filter(e=>"output_text"===e.type),k=_.output.filter(e=>"function_call"===e.type).map(e=>({toolCallType:"function",toolCallId:e.call_id,toolName:e.name,args:e.arguments})),x=null!=(n=null==(s=_.output.find(e=>"reasoning"===e.type))?void 0:s.summary)?n:null;return{text:b.map(e=>e.text).join("\n"),sources:b.flatMap(e=>e.annotations.map(e=>{var t,s,n;return{sourceType:"url",id:null!=(n=null==(s=(t=this.config).generateId)?void 0:s.call(t))?n:C(),url:e.url,title:e.title}})),finishReason:ve({finishReason:null==(o=_.incomplete_details)?void 0:o.reason,hasToolCalls:k.length>0}),toolCalls:k.length>0?k:void 0,reasoning:x?x.map(e=>({type:"text",text:e.text})):void 0,usage:{promptTokens:_.usage.input_tokens,completionTokens:_.usage.output_tokens},rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:v,body:w},request:{body:JSON.stringify(u)},response:{id:_.id,timestamp:new Date(1e3*_.created_at),modelId:_.model},providerMetadata:{openai:{responseId:_.id,cachedPromptTokens:null!=(a=null==(r=_.usage.input_tokens_details)?void 0:r.cached_tokens)?a:null,reasoningTokens:null!=(l=null==(i=_.usage.output_tokens_details)?void 0:i.reasoning_tokens)?l:null}},warnings:p}}async doStream(e){const{args:t,warnings:s}=this.getArgs(e),{responseHeaders:n,value:o}=await A({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:I(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:K,successfulResponseHandler:V(be),abortSignal:e.abortSignal,fetch:this.config.fetch}),r=this;let a="unknown",i=NaN,l=NaN,u=null,p=null,c=null;const d={};let m=!1;return{stream:o.pipeThrough(new TransformStream({transform(e,t){var s,n,o,h,g,f,y,v;if(!e.success)return a="error",void t.enqueue({type:"error",error:e.error});const _=e.value;if(function(e){return"response.output_item.added"===e.type}(_))"function_call"===_.item.type&&(d[_.output_index]={toolName:_.item.name,toolCallId:_.item.call_id},t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:_.item.call_id,toolName:_.item.name,argsTextDelta:_.item.arguments}));else if(function(e){return"response.function_call_arguments.delta"===e.type}(_)){const e=d[_.output_index];null!=e&&t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:e.toolCallId,toolName:e.toolName,argsTextDelta:_.delta})}else!function(e){return"response.created"===e.type}(_)?!function(e){return"response.output_text.delta"===e.type}(_)?!function(e){return"response.reasoning_summary_text.delta"===e.type}(_)?!function(e){return"response.output_item.done"===e.type}(_)||"function_call"!==_.item.type?!function(e){return"response.completed"===e.type||"response.incomplete"===e.type}(_)?!function(e){return"response.output_text.annotation.added"===e.type}(_)?function(e){return"error"===e.type}(_)&&t.enqueue({type:"error",error:_}):t.enqueue({type:"source",source:{sourceType:"url",id:null!=(v=null==(y=(f=r.config).generateId)?void 0:y.call(f))?v:C(),url:_.annotation.url,title:_.annotation.title}}):(a=ve({finishReason:null==(s=_.response.incomplete_details)?void 0:s.reason,hasToolCalls:m}),i=_.response.usage.input_tokens,l=_.response.usage.output_tokens,u=null!=(o=null==(n=_.response.usage.input_tokens_details)?void 0:n.cached_tokens)?o:u,p=null!=(g=null==(h=_.response.usage.output_tokens_details)?void 0:h.reasoning_tokens)?g:p):(d[_.output_index]=void 0,m=!0,t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:_.item.call_id,toolName:_.item.name,args:_.item.arguments})):t.enqueue({type:"reasoning",textDelta:_.delta}):t.enqueue({type:"text-delta",textDelta:_.delta}):(c=_.response.id,t.enqueue({type:"response-metadata",id:_.response.id,timestamp:new Date(1e3*_.response.created_at),modelId:_.response.model}))},flush(e){e.enqueue({type:"finish",finishReason:a,usage:{promptTokens:i,completionTokens:l},...(null!=u||null!=p)&&{providerMetadata:{openai:{responseId:c,cachedPromptTokens:u,reasoningTokens:p}}}})}})),rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:n},request:{body:JSON.stringify(t)},warnings:s}}},we=c({input_tokens:g(),input_tokens_details:c({cached_tokens:g().nullish()}).nullish(),output_tokens:g(),output_tokens_details:c({reasoning_tokens:g().nullish()}).nullish()}),be=b([c({type:y("response.output_text.delta"),delta:h()}),c({type:v(["response.completed","response.incomplete"]),response:c({incomplete_details:c({reason:h()}).nullish(),usage:we})}),c({type:y("response.created"),response:c({id:h(),created_at:g(),model:h()})}),c({type:y("response.output_item.done"),output_index:g(),item:f("type",[c({type:y("message")}),c({type:y("function_call"),id:h(),call_id:h(),name:h(),arguments:h(),status:y("completed")})])}),c({type:y("response.function_call_arguments.delta"),item_id:h(),output_index:g(),delta:h()}),c({type:y("response.output_item.added"),output_index:g(),item:f("type",[c({type:y("message")}),c({type:y("function_call"),id:h(),call_id:h(),name:h(),arguments:h()})])}),c({type:y("response.output_text.annotation.added"),annotation:c({type:y("url_citation"),url:h(),title:h()})}),c({type:y("response.reasoning_summary_text.delta"),item_id:h(),output_index:g(),summary_index:g(),delta:h()}),c({type:y("error"),code:h(),message:h(),param:h().nullish(),sequence_number:g()}),c({type:h()}).passthrough()]);var ke=c({metadata:w().nullish(),parallelToolCalls:_().nullish(),previousResponseId:h().nullish(),store:_().nullish(),user:h().nullish(),reasoningEffort:h().nullish(),strictSchemas:_().nullish(),instructions:h().nullish(),reasoningSummary:h().nullish()}),xe=c({});var Ie={webSearchPreview:function({searchContextSize:e,userLocation:t}={}){return{type:"provider-defined",id:"openai.web_search_preview",args:{searchContextSize:e,userLocation:t},parameters:xe}}},Te=c({instructions:h().nullish(),speed:g().min(.25).max(4).default(1).nullish()}),Se=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({text:e,voice:t="alloy",outputFormat:s="mp3",speed:n,instructions:o,providerOptions:r}){const a=[],i=O({provider:"openai",providerOptions:r,schema:Te}),l={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:n,instructions:o};if(s&&(["mp3","opus","aac","flac","wav","pcm"].includes(s)?l.response_format=s:a.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${s}. Using mp3 instead.`})),i){const e={};for(const t in e){const s=e[t];void 0!==s&&(l[t]=s)}}return{requestBody:l,warnings:a}}async doGenerate(e){var s,n,o;const r=null!=(o=null==(n=null==(s=this.config._internal)?void 0:s.currentDate)?void 0:n.call(s))?o:new Date,{requestBody:a,warnings:i}=this.getArgs(e),{value:l,responseHeaders:u,rawValue:p}=await A({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:I(this.config.headers(),e.headers),body:a,failedResponseHandler:K,successfulResponseHandler:async({response:e,url:s,requestBodyValues:n})=>{const o=S(e);if(!e.body)throw new t({message:"Response body is empty",url:s,requestBodyValues:n,statusCode:e.status,responseHeaders:o,responseBody:void 0});try{const t=await e.arrayBuffer();return{responseHeaders:o,value:new Uint8Array(t)}}catch(r){throw new t({message:"Failed to read response as array buffer",url:s,requestBodyValues:n,statusCode:e.status,responseHeaders:o,responseBody:void 0,cause:r})}},abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:l,warnings:i,request:{body:JSON.stringify(a)},response:{timestamp:r,modelId:this.modelId,headers:u,body:p}}}};function Ce(e={}){var t,s,n;const o=null!=(t=null==(r=e.baseURL)?void 0:r.replace(/\/$/,""))?t:"https://api.openai.com/v1";var r;const a=null!=(s=e.compatibility)?s:"compatible",i=null!=(n=e.name)?n:"openai",l=()=>({Authorization:`Bearer ${R({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),u=(t,s={})=>new Q(t,s,{provider:`${i}.chat`,url:({path:e})=>`${o}${e}`,headers:l,compatibility:a,fetch:e.fetch}),p=(t,s={})=>new re(t,s,{provider:`${i}.completion`,url:({path:e})=>`${o}${e}`,headers:l,compatibility:a,fetch:e.fetch}),c=(t,s={})=>new le(t,s,{provider:`${i}.embedding`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),d=(t,s={})=>new de(t,s,{provider:`${i}.image`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),m=t=>new fe(t,{provider:`${i}.transcription`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),h=t=>new Se(t,{provider:`${i}.speech`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),g=(e,t)=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return"gpt-3.5-turbo-instruct"===e?p(e,t):u(e,t)},f=function(e,t){return g(e,t)};return f.languageModel=g,f.chat=u,f.completion=p,f.responses=t=>new _e(t,{provider:`${i}.responses`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),f.embedding=c,f.textEmbedding=c,f.textEmbeddingModel=c,f.image=d,f.imageModel=d,f.transcription=m,f.transcriptionModel=m,f.speech=h,f.speechModel=h,f.tools=Ie,f}Ce({compatibility:"strict"});export{Ce as createOpenAI};
//# sourceMappingURL=index-bVKPJrRP.js.map

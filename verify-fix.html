<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NanoBanana Fix Verification</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #0a0a0a;
            color: #00ff00;
        }
        .test-card {
            background: #1a1a1a;
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .success { color: #00ff00; font-weight: bold; }
        .error { color: #ff0000; font-weight: bold; }
        .info { color: #00ffff; }
        .warning { color: #ffff00; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-family: monospace;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
        }
        button:hover {
            background: #00cc00;
        }
        #results {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸŒ NanoBanana Fix Verification</h1>

    <div class="test-card">
        <h2>ä¿®æ­£å†…å®¹ã®ç¢ºèª</h2>
        <ul>
            <li class="success">âœ… ç’°å¢ƒæ¤œå‡ºã‚’ã€ŒUnknown Environmentã€ã¨ã—ã¦æ‰±ã†ã‚ˆã†ä¿®æ­£</li>
            <li class="success">âœ… APIèªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç›´æ¥è¨­å®šï¼ˆBearer sk-YOUWAREï¼‰</li>
            <li class="success">âœ… callYouWareAPIã‚’ç›´æ¥fetchã«ç½®ãæ›ãˆ</li>
            <li class="success">âœ… source_code (11)ã®æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é©ç”¨</li>
        </ul>
    </div>

    <div class="test-card">
        <h2>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
        <button onclick="testDirectAPI()">1. Direct API Test (æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³)</button>
        <button onclick="testWithYwConfig()">2. ywConfigç¢ºèª</button>
        <button onclick="testImageGeneration()">3. ç”»åƒç”Ÿæˆãƒ†ã‚¹ãƒˆ</button>
        <button onclick="clearResults()">Clear</button>
    </div>

    <div class="test-card">
        <h2>çµæœãƒ­ã‚°</h2>
        <div id="results"></div>
    </div>

    <script>
        const resultsDiv = document.getElementById('results');

        function log(message, type = 'info') {
            const timestamp = new Date().toISOString().substr(11, 12);
            const color = {
                success: '#00ff00',
                error: '#ff0000',
                warning: '#ffff00',
                info: '#00ffff'
            }[type] || '#ffffff';

            resultsDiv.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
            log('ãƒ­ã‚°ã‚¯ãƒªã‚¢', 'info');
        }

        async function testDirectAPI() {
            log('========== Direct API Test Start ==========', 'info');

            try {
                const requestBody = {
                    model: 'nano-banana',
                    prompt: 'Test: Generate a simple geometric shape for verification',
                    n: 1,
                    response_format: 'b64_json'
                };

                log('Sending request to: https://api.youware.com/public/v1/ai/images/generations', 'info');
                log('Headers: Authorization: Bearer sk-YOUWARE', 'info');
                log('Model: nano-banana', 'info');

                const response = await fetch('https://api.youware.com/public/v1/ai/images/generations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-YOUWARE'
                    },
                    body: JSON.stringify(requestBody)
                });

                log(`Response Status: ${response.status} ${response.statusText}`,
                    response.ok ? 'success' : 'error');

                if (response.ok) {
                    const data = await response.json();
                    log('âœ… SUCCESS! NanoBanana API is working correctly!', 'success');
                    log(`Response keys: ${Object.keys(data).join(', ')}`, 'info');

                    if (data.data && data.data[0]) {
                        log('âœ… Image data received successfully', 'success');
                        log(`Image format: ${data.data[0].b64_json ? 'base64' : 'url'}`, 'info');
                    }
                } else {
                    const errorText = await response.text();
                    log(`âŒ Error: ${errorText}`, 'error');

                    // ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’è§£æ
                    try {
                        const errorData = JSON.parse(errorText);
                        if (errorData.error?.code === 40101) {
                            log('âŒ Authentication error (40101) - ä¿®æ­£ãŒå¿…è¦ã§ã™', 'error');
                        }
                    } catch (e) {}
                }

            } catch (error) {
                log(`âŒ Network error: ${error.message}`, 'error');
            }

            log('========== Direct API Test End ==========', 'info');
        }

        async function testWithYwConfig() {
            log('========== ywConfig Check Start ==========', 'info');

            // ywConfigã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
            if (!window.ywConfig && !globalThis.ywConfig) {
                globalThis.ywConfig = {
                    name: "maps-to-cad-illustrator",
                    version: "0.0.0",
                    project_type: "react",
                    ai_config: {
                        isometric_generator: { model: "nano-banana", response_format: "b64_json", n: 1 },
                        hologram_generator: { model: "nano-banana", response_format: "b64_json", n: 1 },
                        line_art_generator: { model: "nano-banana", response_format: "b64_json", n: 1 }
                    }
                };
                log('âœ… ywConfig created', 'success');
            } else {
                log('âœ… ywConfig already exists', 'success');
            }

            const config = globalThis.ywConfig || window.ywConfig;
            log(`AI Configs: ${Object.keys(config.ai_config).join(', ')}`, 'info');
            log(`All using model: ${config.ai_config.isometric_generator.model}`, 'info');

            log('========== ywConfig Check End ==========', 'info');
        }

        async function testImageGeneration() {
            log('========== Image Generation Test Start ==========', 'info');

            const scenarios = [
                { type: 'isometric', prompt: 'Create an isometric 3D building block' },
                { type: 'hologram', prompt: 'Create a holographic projection' },
                { type: 'line_art', prompt: 'Create a line art drawing' }
            ];

            for (const scenario of scenarios) {
                log(`Testing ${scenario.type}...`, 'info');

                try {
                    const response = await fetch('https://api.youware.com/public/v1/ai/images/generations', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer sk-YOUWARE'
                        },
                        body: JSON.stringify({
                            model: 'nano-banana',
                            prompt: scenario.prompt,
                            n: 1,
                            response_format: 'b64_json'
                        })
                    });

                    if (response.ok) {
                        log(`âœ… ${scenario.type}: SUCCESS (Status ${response.status})`, 'success');
                    } else {
                        log(`âŒ ${scenario.type}: FAILED (Status ${response.status})`, 'error');
                    }
                } catch (error) {
                    log(`âŒ ${scenario.type}: Network error`, 'error');
                }
            }

            log('========== Image Generation Test End ==========', 'info');
        }

        // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        window.addEventListener('load', () => {
            log('ğŸš€ NanoBanana Fix Verification Tool Ready', 'success');
            log('ä¿®æ­£ãŒæ­£ã—ãé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„', 'info');
            log('YouWareã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã€ã“ã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'warning');
        });
    </script>
</body>
</html>